# Disclaimer: following config is adapted for Dvorak layout
# https://github.com/vbauerster/PDvorak

# Cool arcticles about tmux:
# https://github.com/tmux/tmux/blob/master/FAQ
# https://robots.thoughtbot.com/love-hate-tmux
# https://gist.github.com/MohamedAlaa/2961058
# https://github.com/tmux-plugins/tmux-sensible
# https://learnxinyminutes.com/docs/tmux

# Hierarchy:
#  Server
#  ㄴSession
#    ㄴWindow
#      ㄴPane

# Options:
# - Session options (set-option [-g])
# - Window options (set-window-option [-g])

# -------------------------------------------------------------------
# Session options
# -------------------------------------------------------------------
# ~/dotfiles/resources/tmux-256color.terminfo
set-option -g default-terminal "tmux-256color"
# improve colors
# https://wiki.archlinux.org/index.php/Tmux#24-bit_color
set-option -ga terminal-overrides ",xterm-256color:Tc"
# <S-Home><S-End>
set-option -ga terminal-overrides ',xterm-256color:kEND=\E[F:kHOM=\E[H'
# https://wiki.archlinux.org/index.php/Tmux#xterm-keys
set-option -g xterm-keys on

# Before disabling following option,
# make sure you have the "Applications in terminal may access clipboard" option set when using iTerm2
set-option -g default-command "reattach-to-user-namespace -l $SHELL"

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set-option -s escape-time 0

# increase scrollback buffer size
set-option -g history-limit 50000

# tmux messages are displayed for 3 seconds
set-option -g display-time 3000

# Update the status bar every sixty seconds
# devault value is 15
set-option -g status-interval 10

# Unbind C-b (the default prefix)
unbind-key C-b
# C-b is not acceptable as a prefix, neither C-a, because both are used by Vim
# http://superuser.com/a/178223/578741
set-option -g prefix C-Space

# emacs key bindings in tmux command prompt (prefix + :) are better than
# vi keys, even for vim users
set-option -g status-keys emacs

# requires by 'roxma/vim-tmux-clipboard'
# focus events enabled for terminals that support them
set-option -g focus-events on

# start window numbers at 1 to match keyboard order with tmux window order
set-option -g base-index 1

# renumber windows sequentially after closing any of them
set-option -g renumber-windows on

# increase scrollback lines
set-option -g history-limit 10000

# Mouse
set-option -g mouse on

# remove administrative debris (session name, hostname, time) in status bar
# set -g status-left ''
# set -g status-right '#[bold]#(xkbswitch -ge) ● #H#[default] '
# set-option -g status-right "#(xkbswitch -ge) ● #(date '+%a, %b %d - %H:%M')"
set-option -g status-right '#{prefix_highlight} | #(xkbswitch -ge) | %a %d-%m-%Y %H:%M'

# -------------------------------------------------------------------
# Window options
# -------------------------------------------------------------------
# Copy-mode
set-window-option -g mode-keys vi

set-window-option -g pane-base-index 1

# super useful when using "grouped sessions" and multi-monitor setup
set-window-option -g aggressive-resize on

# visual notification of activity in other windows
set-window-option -g monitor-activity on
# set -g visual-activity on

# auto rename
# set-window-option -g automatic-rename on

# -------------------------------------------------------------------
# Key bindings
# -------------------------------------------------------------------
# prefix c
# bind-key c new-window -c "#{pane_current_path}"

# horizontal split
bind-key % split-window -h -c "#{pane_current_path}"

# vertical split
bind-key '"' split-window -c "#{pane_current_path}"

# Moving windows
bind-key -r > swap-window -t :+
bind-key -r < swap-window -t :-
# http://superuser.com/questions/343572/how-do-i-reorder-tmux-windows
bind-key : swap-window -t 1

bind-key 1 switch-client -p
bind-key 2 switch-client -n
bind-key 5 swap-pane -U
bind-key 3 swap-pane -D
bind-key * choose-buffer

bind-key ( select-window -t :=1
bind-key ) select-window -t :=2
bind-key } select-window -t :=3
bind-key + select-window -t :=4
bind-key { select-window -t :=5
bind-key ] select-window -t :=6
bind-key [ select-window -t :=7
bind-key ! select-window -t :=8
bind-key = select-window -t :=9

# shortcut for reloading config
bind-key R source-file ~/.tmux.conf \; display-message "[tmux] reloaded"

# fzf-locate
# https://github.com/junegunn/fzf/wiki/Examples-(tmux)
# -n means binding without prefix
bind-key -n 'M-g' run "tmux split-window -p 40 'tmux send-keys -t #{pane_id} \"$(locate / | fzf -m | paste -sd\\  -)\"'"

# Capture pane and open in Vim
bind-key -n 'M-t' run 'tmux capture-pane -S -10000 -p > /tmp/tmux-capture.txt'\;\
             new-window "nvim /tmp/tmux-capture.txt"

# copy-mode-vi bindings
# https://github.com/tmux/tmux/issues/592
# https://github.com/tmux/tmux/commit/76d6d3641f271be1756e41494960d96714e7ee58
bind -Tcopy-mode-vi 'v' send -X begin-selection
# Enter = copy-selection-and-cancel
bind -Tcopy-mode-vi 'y' send -X copy-selection
bind -Tcopy-mode-vi Space send -X halfpage-down
bind -Tcopy-mode-vi Bspace send -X halfpage-up

bind-key - copy-mode

# switch to last window
unbind l
bind-key Space last-window

# send prefix key, if not in vim
# <C-Space><C-Space> (whithout depressing ctrl)
bind-key C-Space if-shell "$is_vim" "send-keys C-Space" "send-prefix"

# Restoring Clear Screen (C-l)
bind-key Enter send-keys C-l

# Switch to last session
unbind L
bind-key Escape switch-client -l

# jump between panes
bind-key Tab select-pane -t :.+
bind-key BTab select-pane -t :.-

bind-key \; command-prompt

# Synchronize panes
# https://sanctum.geek.nz/arabesque/sync-tmux-panes/
bind-key 0 set-window-option synchronize-pane

# pane movement
# http://unix.stackexchange.com/questions/14300/moving-tmux-pane-to-window
# bind-key j command-prompt -p "join pane from:"  "join-pane -s ':%%'"
bind-key @ command-prompt -p "send pane to:"  "join-pane -t ':%%'"

# Marked pane must be present (prefix-m), for the j and r bindings.
# The marked pane will be used as -s src-pane, whereas -t dst-pane is active pane
bind-key j join-pane
bind-key r swap-pane

# Move pane to new Tab(window)
bind-key T break-pane

# resize panes using PREFIX + shift + [hjkc]
# https://github.com/tmux-plugins/tmux-pain-control
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r C resize-pane -R 5

bind-key M-v select-layout even-horizontal
bind-key M-h select-layout even-vertical
bind-key M-n next-layout

# bind-key e send "V" C-m "nvim " \; paste-buffer \; send C-m

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'vbauerster/vim-tmux-navigator'
set -g @plugin 'seebi/tmux-colors-solarized'
# set -g @plugin 'tmux-plugins/tmux-copycat'
# set -g @plugin 'thalesmello/tmux-copycat'
# set -g @plugin 'tmux-plugins/tmux-open'
# set -g @plugin 'tmux-plugins/tmux-sidebar'
# set -g @plugin 'jbnicolai/tmux-fpp'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

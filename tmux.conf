# https://robots.thoughtbot.com/love-hate-tmux

# improve colors
# https://wiki.archlinux.org/index.php/Tmux#24-bit_color
set-option -ga terminal-overrides ",xterm-256color:Tc"
set -g default-terminal 'screen-256color'

# escape delay
set -sg escape-time 1

# Update the status bar every sixty seconds
# devault value is 15
set -g status-interval 60

# Unbind C-b (the default prefix)
unbind C-b

# C-b is not acceptable as a prefix, neither C-a, because both are used by Vim
# Bind C-- as a prefix
# http://unix.stackexchange.com/questions/158278/tmux-how-do-i-bind-to-c-control-minus
set -g prefix C-_
# use send-prefix to pass the prefix through
bind Space send-prefix

# shortcut for reloading config
bind r source-file ~/.tmux.conf \; display " ✱ ~/.tmux.conf is reloaded"

# provide access to the clipboard for pbpaste, pbcopy
set-option -g default-command "reattach-to-user-namespace -l zsh"

# fzf-locate
# -n means binding without prefix
bind -n 'M-g' run "tmux split-window -p 40 'tmux send-keys -t #{pane_id} \"$(locate / | fzf -m | paste -sd\\  -)\"'"

# start window numbers at 1 to match keyboard order with tmux window order
set -g base-index 1
setw -g pane-base-index 1

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# increase scrollback lines
set -g history-limit 10000

# Use vi keybindings for tmux commandline input.
# Note that to get command mode you need to hit ESC twice...
set -g status-keys vi

# y and p as in vim
# https://gist.github.com/anonymous/6bebae3eb9f7b972e6f0
setw -g mode-keys vi
# bind Space copy-mode # use [
bind p paste-buffer

# setup 'v' to begin selection as in Vim
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"
bind -t vi-copy Space halfpage-down
bind -t vi-copy Bspace halfpage-up
bind y run 'tmux save-buffer - | reattach-to-user-namespace pbcopy '

# switch to last window
unbind l
bind - last-window\; refresh-client -S

# p is bound to paste
bind u previous-window\; refresh-client -S
unbind n
bind h next-window\; refresh-client -S

# Make the current window the Top window
# http://superuser.com/questions/343572/how-do-i-reorder-tmux-windows
bind T swap-window -t 1

# Smart pane switching with awareness of vim splits
# https://github.com/christoomey/vim-tmux-navigator
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "last-pane"
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# pane movement
# http://unix.stackexchange.com/questions/14300/moving-tmux-pane-to-window
bind-key j command-prompt -p "join pane from:"  "join-pane -s '%%'"
bind-key @ command-prompt -p "send pane to:"  "join-pane -t '%%'"

# <prefix> Escape to clear the screen
bind Escape send-keys 'C-l'

# resize panes using PREFIX H, J, K, L
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind M-h select-layout main-horizontal
bind M-v select-layout main-vertical

# visual notification of activity in other windows
setw -g monitor-activity on
# set -g visual-activity on

# auto rename
setw -g automatic-rename on

# remove administrative debris (session name, hostname, time) in status bar
# set -g status-left ''
# set -g status-right '#[bold]#(xkbswitch -ge) ● #H#[default] '
set -g status-right "#(xkbswitch -ge) ● #(date '+%a, %b %d - %H:%M')"

# https://github.com/seebi/tmux-colors-solarized
if-shell "[ -f ~/.tmuxcolors-256.conf ]" 'source ~/.tmuxcolors-256.conf'
